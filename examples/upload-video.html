<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudioBot.ai - Direct Video Upload</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    input[type="text"],
    input[type="file"],
    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input:focus,
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      left: -9999px;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      border: 2px dashed #667eea;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      background: #f8f9ff;
    }

    .file-input-label:hover {
      background: #eff1ff;
      border-color: #5568d3;
    }

    .file-input-label.has-file {
      border-color: #4caf50;
      background: #f1f8f4;
    }

    .file-info {
      text-align: center;
    }

    .file-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .upload-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .upload-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .upload-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .progress-container {
      margin-top: 20px;
      display: none;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      width: 0%;
      transition: width 0.3s;
    }

    .progress-text {
      text-align: center;
      margin-top: 10px;
      color: #666;
      font-size: 14px;
    }

    .result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 8px;
      display: none;
    }

    .result.success {
      background: #f1f8f4;
      border: 2px solid #4caf50;
      color: #2e7d32;
    }

    .result.error {
      background: #fff3f3;
      border: 2px solid #f44336;
      color: #c62828;
    }

    .result h3 {
      margin-bottom: 10px;
    }

    .result-details {
      font-size: 14px;
      line-height: 1.6;
    }

    .supported-formats {
      font-size: 12px;
      color: #999;
      margin-top: 10px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¬ StudioBot.ai</h1>
    <p class="subtitle">Upload your video for AI-powered viral moment detection</p>

    <form id="uploadForm">
      <div class="form-group">
        <label>User ID</label>
        <input type="text" id="userId" value="test-user-123" required>
      </div>

      <div class="form-group">
        <label>Video Title</label>
        <input type="text" id="title" placeholder="Enter video title" required>
      </div>

      <div class="form-group">
        <label>Description (Optional)</label>
        <textarea id="description" placeholder="Add a description..."></textarea>
      </div>

      <div class="form-group">
        <label>Video File</label>
        <div class="file-input-wrapper">
          <input type="file" id="videoFile" accept="video/*" required>
          <label for="videoFile" class="file-input-label" id="fileLabel">
            <div class="file-info">
              <div class="file-icon">ðŸ“¹</div>
              <div>
                <strong>Click to select video</strong><br>
                <span style="font-size: 12px; color: #999;">or drag and drop</span>
              </div>
            </div>
          </label>
        </div>
        <div class="supported-formats">
          Supported: MP4, MOV, AVI, WebM, MKV (Max 500MB)
        </div>
      </div>

      <button type="submit" class="upload-btn" id="uploadBtn">
        ðŸš€ Upload & Analyze
      </button>
    </form>

    <div class="progress-container" id="progressContainer">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">Uploading...</div>
    </div>

    <div class="result" id="result">
      <h3 id="resultTitle"></h3>
      <div class="result-details" id="resultDetails"></div>
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000/api';
    let selectedFile = null;

    // Handle file selection
    document.getElementById('videoFile').addEventListener('change', (e) => {
      selectedFile = e.target.files[0];
      const label = document.getElementById('fileLabel');

      if (selectedFile) {
        const sizeMB = (selectedFile.size / (1024 * 1024)).toFixed(2);
        label.classList.add('has-file');
        label.innerHTML = `
          <div class="file-info">
            <div class="file-icon">âœ…</div>
            <div>
              <strong>${selectedFile.name}</strong><br>
              <span style="font-size: 12px; color: #999;">${sizeMB} MB</span>
            </div>
          </div>
        `;
      }
    });

    // Handle form submission
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!selectedFile) {
        showResult('error', 'Please select a video file');
        return;
      }

      const userId = document.getElementById('userId').value;
      const title = document.getElementById('title').value;
      const description = document.getElementById('description').value;

      // Prepare form data
      const formData = new FormData();
      formData.append('video', selectedFile);
      formData.append('user_id', userId);
      formData.append('title', title);
      formData.append('description', description);

      // Show progress
      document.getElementById('progressContainer').style.display = 'block';
      document.getElementById('uploadBtn').disabled = true;
      document.getElementById('result').style.display = 'none';

      try {
        // Upload video
        const response = await fetch(`${API_URL}/videos/upload-file`, {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (response.ok) {
          showResult('success',
            `Video Uploaded Successfully!`,
            `
              <strong>Video ID:</strong> ${data.data.id}<br>
              <strong>Status:</strong> ${data.data.status}<br>
              <strong>Size:</strong> ${(data.fileInfo.size / (1024 * 1024)).toFixed(2)} MB<br>
              <strong>Message:</strong> ${data.message}<br><br>
              AI analysis is now running. Check back in a few minutes!
            `
          );
        } else {
          showResult('error', 'Upload Failed', data.message || 'Unknown error');
        }
      } catch (error) {
        showResult('error', 'Upload Failed', error.message);
      } finally {
        document.getElementById('progressContainer').style.display = 'none';
        document.getElementById('uploadBtn').disabled = false;
      }
    });

    function showResult(type, title, details = '') {
      const result = document.getElementById('result');
      result.className = `result ${type}`;
      result.style.display = 'block';
      document.getElementById('resultTitle').textContent = title;
      document.getElementById('resultDetails').innerHTML = details;
    }

    // Drag and drop
    const fileLabel = document.getElementById('fileLabel');

    fileLabel.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileLabel.style.borderColor = '#5568d3';
    });

    fileLabel.addEventListener('dragleave', () => {
      fileLabel.style.borderColor = '#667eea';
    });

    fileLabel.addEventListener('drop', (e) => {
      e.preventDefault();
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        document.getElementById('videoFile').files = files;
        // Trigger change event
        const event = new Event('change');
        document.getElementById('videoFile').dispatchEvent(event);
      }
    });
  </script>
</body>
</html>
